/***************************************Copyright(c)************************************************
****************************************************************************************************
***** 文    件 :Dev_Timer.c
***** 设    计 :sevenblock
***** 描    述 :
***** 版    本 :V1.0
***** 时    间 :2017-05-03
***** 备    注 :
****************************************************************************************************
***************************************************************************************************/
#define Dev_Timer_D
#include "..\block\app\App_Macro.h"

#define Dev_Timer_ID		10

volatile u32 nSysTickCnt = 0;
volatile u32 nDelayCnt = 0;

/*
****************************************************************************************************
** 名    称 ：Dev_Timer_Init()
** 功    能 ：
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
void Dev_Timer_Init(void)
{	
	SYST_Config(SYST_SCLK, SCM_GetSysClk()/1000, SYST_INT);		// 1ms
}

/*
****************************************************************************************************
** 名    称 ：Dev_Timer_Test()
** 功    能 ：
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
void Dev_Timer_Test(void)
{
	if(nSysTickCnt >= 1000*2)
	{
		DDEBUG("nSysTickCnt");

		nSysTickCnt = 0;

		Dev_Adc_Test();
	}
}

/*
****************************************************************************************************
** 名    称 ：SysTick_Handler()
** 功    能 ：1ms
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
 void SysTick_Handler(void)
{	
	nSysTickCnt++;	  

	if(nDelayCnt)
	{
		nDelayCnt--;
	}
	
	App_Main_IRQ1Ms();
}

/*
****************************************************************************************************
** 名    称 ：Dev_Timer_GetTick()
** 功    能 ：
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
u32 Dev_Timer_GetTick(void)
{
	return nSysTickCnt;
}

/*
****************************************************************************************************
** 名    称 ：Dev_Timer_IsTimeOut()
** 功    能 ：
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
s32 Dev_Timer_IsTimeOut(u32 t_nTick,u32 t_nDelay)
{
	#if 1
	if((0xFFFFFFFF-t_nTick) > t_nDelay)
	{
		if(nSysTickCnt >= (u32)(t_nDelay+t_nTick))
		{
			return 1;
		}
	}
	else
	{
		if((nSysTickCnt < t_nTick) && (nSysTickCnt >= (u32)(t_nTick + t_nDelay)))
		{
			return 2;
		}
	}
	#else
	if((nSysTickCnt - t_nTick) > t_nDelay)
	{
		return 1;
	}
	#endif
	
	return 0;
}

/*
****************************************************************************************************
** 名    称 ：Dev_Timer_DelayMs()
** 功    能 ：
** 入口参数 ：无
** 出口参数 ：无
** 返    回 ：
** 备    注 ：
****************************************************************************************************
*/
void Dev_Timer_DelayMs(u32 t_nDelays)
{
	nDelayCnt = t_nDelays;

	while(nDelayCnt);
}
 
/****************************************End Of File************************************************
***************************************************************************************************/

